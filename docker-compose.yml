version: "3.9"

services:
  # --- DATABASES ---
  users-db:
    image: postgres:15
    container_name: users_db
    restart: unless-stopped
    env_file:
      - ./services/users_service/.env
    ports:
      - "5433:5432"
    volumes:
      - users_data:/var/lib/postgresql/data

  products-db:
    image: postgres:15
    container_name: products_db
    restart: unless-stopped
    env_file:
      - ./services/products_service/.env
    ports:
      - "5434:5432"
    volumes:
      - products_data:/var/lib/postgresql/data

  orders-db:
    image: postgres:15
    container_name: orders_db
    restart: unless-stopped
    env_file:
      - ./services/orders_service/.env
    ports:
      - "5435:5432"
    volumes:
      - orders_data:/var/lib/postgresql/data

  payments-db:
    image: postgres:15
    container_name: payments_db
    restart: unless-stopped
    env_file:
      - ./services/payments_service/.env
    ports:
      - "5436:5432"
    volumes:
      - payments_data:/var/lib/postgresql/data

  # --- SERVICES ---
  users-service:
    build: ./services/users_service
    container_name: users_service
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./services/users_service:/app
    ports:
      - "8001:8000"
    env_file:
      - ./services/users_service/.env
    depends_on:
      - users-db

  products-service:
    build: ./services/products_service
    container_name: products_service
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./services/products_service:/app
    ports:
      - "8002:8000"
    env_file:
      - ./services/products_service/.env
    depends_on:
      - products-db

  orders-service:
    build: ./services/orders_service
    container_name: orders_service
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./services/orders_service:/app
    ports:
      - "8003:8000"
    env_file:
      - ./services/orders_service/.env
    depends_on:
      - orders-db

  payments-service:
    build: ./services/payments_service
    container_name: payments_service
    command: python manage.py runserver 0.0.0.0:8000
    volumes:
      - ./services/payments_service:/app
    ports:
      - "8004:8000"
    env_file:
      - ./services/payments_service/.env
    depends_on:
      - payments-db

volumes:
  users_data:
  products_data:
  orders_data:
  payments_data:
